--VALIDATI:

SELECT DATEPART(year, dataValidazione) AS Anno,
c.area,
       sum(IIF(isnull(dataValidazione, '') <> '', 1, 0)) AS Validati,
          SUM(isnull(tar.prezzo, 0)) AS PrezzoTariffario,
		SUM(p.ore) SommaPD
		--SUM(CASE
		--WHEN isnull(p.oreCM,0)<>0
		--THEN p.oreCM
		--WHEN isnull(p.oreCM,0)=0
		--THEN 0.16
		--END) AS SommaPD
        
FROM [anagraf].[dbo].[WEB_ModuloC_oggetti] o
inner join anagraf.dbo.commissioni c on c.id=o.id_com
     INNER JOIN anagraf.dbo.tipoinserz t ON t.codice = o.codice_oggetto
	left join servizi.dbo.prodottiore p on p.codiceSigla=t.Codice
     LEFT JOIN anagraf.dbo.[Tariffario] tar ON tar.codice = t.codice
WHERE --isnull([oggettiCM_Out], 0) = 0
       DATEPART(year, dataValidazione) IN(2018, 2019, 2020, 2021)
	  and t.Codice IN (68,
69,
70,
71,
341,
342,
364,
407,
408,
453,
454,
455,
456,
457,
458,
459,
460,
461,
462,
463,
464,
465,
476,
477,
478,
479,
480,
481,
482,
483,
484,
485,
486,
491,
594,
595,
596,
597,
599,
600,
601,
602,
624,
627,
632,
633,
634,
635,
636,
657,
658,
659,
664,
680,
704,
705,
706,
707,
708,
717,
718,
719,
720,
721,
722,
723,
724,
740,
741,
742,
743,
841,
844,
852,
853,
854,
855,
856,
900,
908,
930,
931,
995,
1010,
1014,
1074,
1076,
1113,
1187,
1188,
1189,
1190,
1191,
1192,
1193,
1194,
1205,
1207,
1208,
1209,
1210,
1211,
1212,
1213,
1214,
1215,
1216,
1217,
1218,
1219,
1220,
1221,
1222,
1223,
1224,
1225,
1226,
1229,
1230,
1306,
1335,
1351,
1360,
1361,
1461,
1462,
1463,
1464,
1465,
1466,
1532,
1533,
1534,
1535,
1536,
1537,
1538,
1540,
1542,
1633,
1690,
1752,
1753,
1799,
1805,
1806,
1815,
1831,
1832,
1833,
1834,
1835,
1836,
1837,
1838,
1839,
1840,
1841,
1842,
1843,
1844,
1845,
1851,
1852,
1853,
1858,
1860,
1861,
1862,
1864,
1865,
1866,
1868,
1869,
1871,
1872,
1873,
1874,
1876,
1877,
1891,
1892,
1893,
1894,
1895,
1896,
1901,
1903,
1904,
1907,
1908,
1909,
1910,
1911,
1912,
1913,
1914,
1915,
1916,
1917,
1918,
1919,
1920,
1921,
1922,
1923,
1924,
1925,
1926,
1927)
GROUP BY DATEPART(year, dataValidazione), c.area
order by area, anno asc